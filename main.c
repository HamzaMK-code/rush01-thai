/****************************************************************
 *                     โปรแกรมหลัก (main.c)                   *
 * ------------------------------------------------------------ *
 * จุดเริ่มต้นของโปรแกรม                                     *
 * อ่านเบาะแส (clues) จาก argument ที่ผู้ใช้ส่งมา             *
 * ตรวจสอบความถูกต้องของเบาะแส                               *
 * สร้างแถวที่เป็นไปได้ทั้งหมด (permutations)                *
 * แล้วพยายามแก้ไขตาราง 4x4 ตามเบาะแส                         *
 ****************************************************************/

#include <unistd.h>

// ประกาศฟังก์ชันที่อยู่ในไฟล์อื่น
void    generate_perms(int perms[24][4]);
void    solve(int perms[24][4], int *clues);

// ฟังก์ชันแปลง input string → เก็บเบาะแสทั้ง 16 ลงในอาร์เรย์ `clues`
int parse_input(char *arg, int *clues)
{
    int i;
    int j;

    i = 0;
    j = 0;
    while (arg[i]) // วนอ่านตัวอักษรทีละตัวใน input
    {
        // รับแค่ตัวเลข '1' ถึง '4' เท่านั้น
        if (arg[i] >= '1' && arg[i] <= '4')
        {
            if (j >= 16) // ถ้ามีมากกว่า 16 เบาะแส → ผิด
                return (0);
            clues[j++] = arg[i] - '0'; // แปลงจาก char เป็น int แล้วเก็บ
        }
        // ถ้าไม่ใช่ช่องว่าง → ผิด
        else if (arg[i] != ' ')
            return (0);
        i++;
    }
    return (j == 16); // ถูกต้องเฉพาะกรณีที่มี 16 เบาะแสเป๊ะ
}

// ฟังก์ชันหลัก
int main(int argc, char **argv)
{
    int clues[16];      // อาร์เรย์เก็บเบาะแส 16 ค่า
    int perms[24][4];   // อาร์เรย์เก็บ 24 ความเป็นไปได้ของแถว (4 ค่าไม่ซ้ำกัน)

    // ต้องมี argument เดียวเท่านั้น และต้องแปลงเป็นเบาะแสได้ถูกต้อง
    if (argc != 2 || !parse_input(argv[1], clues))
    {
        write(1, "Error\n", 6); // ถ้าผิดพลาด แสดง "Error"
        return (1);
    }

    // สร้างชุดความเป็นไปได้ของแถวทั้งหมด (permutations)
    generate_perms(perms);

    // ทดลองทุกความเป็นไปได้ เพื่อหา solution ที่ถูกต้องตามเบาะแส
    solve(perms, clues);

    return (0);
}
