
/*************************************************************
 * คัดลอกแถวหนึ่ง (array ที่มี 4 ตัว) ไปอีก array หนึ่ง       *
 *************************************************************/
void    copy_line(int *src, int *dest)
{
    int i = 0;
    while (i < 4)
    {
        dest[i] = src[i];
        i++;
    }
}

/*************************************************************
 * ทดลองนำแถว 4 แถวจาก permutations มาสร้างเป็นตาราง 4x4      *
 * combo[0-3] เป็น index ของแถวที่เลือกจาก perms ทั้งหมด 24 แบบ *
 * ----------------------------------------------------------
 * ถ้าแถวแนวตั้งถูกต้อง และตรงกับ clues ทุกด้าน
 * ให้แสดง grid แล้วคืนค่า 1 (เจอคำตอบ)
 *************************************************************/
int try_combo(int perms[24][4], int *clues, int combo[4])
{
    int grid[4][4];

    copy_line(perms[combo[0]], grid[0]); // คัดลอกแถวที่ 1
    copy_line(perms[combo[1]], grid[1]); // คัดลอกแถวที่ 2
    copy_line(perms[combo[2]], grid[2]); // คัดลอกแถวที่ 3
    copy_line(perms[combo[3]], grid[3]); // คัดลอกแถวที่ 4

    // ถ้าแถวแนวตั้งไม่ซ้ำ และตรงกับเงื่อนไข clues
    if (check_all_cols(grid) && check_clues(grid, clues))
    {
        print_grid(grid); // แสดง grid ที่ถูกต้อง
        return (1);       // คืนค่า 1 ถ้าเจอคำตอบ
    }
    return (0); // ไม่ผ่านเงื่อนไข
}

/*************************************************************
 * ลูปสำหรับลองแถวที่ 3 และ 4 โดยแถวแรกคือ a แถวสองคือ b     *
 * แล้ววนหาแถว c และ d ที่จะใช้                               *
 *************************************************************/
int solve_2(int a, int b, int perms[24][4], int *clues)
{
    int c;
    int d;
    int combo[4]; // เก็บ index ของแถวทั้ง 4 ที่จะลอง

    c = -1;
    while (++c < 24)
    {
        d = -1;
        while (++d < 24)
        {
            combo[0] = a;
            combo[1] = b;
            combo[2] = c;
            combo[3] = d;
            if (try_combo(perms, clues, combo))
                return (1); // ถ้าเจอคำตอบที่ถูกต้อง
        }
    }
    return (0); // ไม่เจอคำตอบที่ใช้ได้
}

/*************************************************************
 * ฟังก์ชันนี้ลองทุกการจัดเรียง 4 แถวที่เป็นไปได้จาก 24 แบบ  *
 * เริ่มจากแถวแรก a และแถวสอง b แล้วเรียก solve_2 มาช่วยต่อ  *
 *************************************************************/
void    solve(int perms[24][4], int *clues)
{
    int a;
    int b;

    a = -1;
    while (++a < 24)
    {
        b = -1;
        while (++b < 24)
        {
            if (solve_2(a, b, perms, clues))
                return; // หยุดทันทีถ้าเจอคำตอบ
        }
    }
    write(1, "Error\n", 6); // ถ้าไม่มีคำตอบเลย ให้แสดง "Error"
}
